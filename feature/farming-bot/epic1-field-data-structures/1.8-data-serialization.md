# Story FB-1.8: Implement Data Serialization

**Story ID**: FB-1.8  
**Epic**: Epic 1 - Field Data Structures  
**Story Points**: 13  
**Priority**: P0 (Blocker)  
**Status**: Not Started  

## Description
Implement JSON-based persistence for all farming configuration data, enabling save/load functionality for fields, crops, and storage settings.

## Acceptance Criteria
- [ ] Create JSON schema for farming configuration
- [ ] Implement Gson serializers/deserializers for all models
- [ ] Create `FarmingConfig.java` root configuration class
- [ ] Support saving to `etc/farming.json5`
- [ ] Support loading from `etc/farming.json5`
- [ ] Handle versioning for future schema changes
- [ ] Add migration support for config updates
- [ ] Validate loaded data and provide error messages
- [ ] Create default empty configuration if file missing

## Technical Notes
- Use existing Gson instance from client (see `Config.java` patterns)
- JSON5 format allows comments for user-friendly editing
- Store in user home directory: `~/.haven/farming.json5`
- Include schema version number for future migrations

**Example JSON structure**:
```json5
{
  "version": 1,
  "fields": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "North Wheat Field",
      "type": "QUANTITY",
      "shape": "RECTANGLE",
      "grid": {
        "type": "rectangle",
        "minX": 100,
        "minY": 200,
        "maxX": 120,
        "maxY": 220
      },
      "cropType": "gfx/terobjs/plants/wheat",
      "enabled": true,
      "createdAt": 1696435200000
    }
  ],
  "storage": [
    {
      "fieldId": "550e8400-e29b-41d4-a716-446655440000",
      "inputChests": [
        {"x": 95, "y": 200, "type": "CHEST"}
      ],
      "outputChests": [
        {"x": 125, "y": 220, "type": "CHEST", "minQuality": -4, "maxQuality": 5}
      ]
    }
  ],
  "crops": [
    {
      "resourceName": "gfx/terobjs/plants/wheat",
      "displayName": "Wheat",
      "growthStages": 7,
      "wateringRequired": false
    }
  ]
}
```

## Files to Create/Modify
- **Create**: `src/auto/farming/config/FarmingConfig.java`
- **Create**: `src/auto/farming/config/ConfigSerializer.java`
- **Create**: `src/auto/farming/config/ConfigLoader.java`
- **Create**: `src/auto/farming/config/ConfigVersion.java`
- **Create**: `etc/farming-schema.json5` (example/template)

## Dependencies
- FB-1.1 (FarmField)
- FB-1.5 (CropConfig)
- FB-1.7 (StorageConfig)

## Testing Notes
- Test save → load → save cycle (data integrity)
- Test with malformed JSON (error handling)
- Test with missing file (create default)
- Test with old version (migration)
- Verify all model classes serialize correctly

## Definition of Done
- [ ] Code implemented and compiles without errors
- [ ] All acceptance criteria met
- [ ] Javadoc complete
- [ ] Manual testing completed
- [ ] Code reviewed
- [ ] Committed to feature branch
